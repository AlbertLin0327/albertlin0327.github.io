<!doctype html><html lang=cn itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=/favicon.png><title>Smart Contract Whitelist Mechanism - Albert Lin's Blog</title><meta name=description content="Common methods of Smart Contract Whitelist Mechanism"><meta name=author content="Albert Lin"><meta name=generator content="Hugo 0.98.0"><link rel=stylesheet href="https://albertlin0327.github.io/css/styles.min.dee972090335124f469658842d34ac946e8ec22748420da61bda7b8213882179.css" integrity="sha256-3ulyCQM1Ek9GlliELTSslG6OwidIQg2mG9p7ghOIIXk="><meta property="og:title" content="Smart Contract Whitelist Mechanism"><meta property="og:description" content="Common methods of Smart Contract Whitelist Mechanism"><meta property="og:type" content="article"><meta property="og:url" content="https://albertlin0327.github.io/cn/blog/220511-nft-minting/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-05-11T00:00:00+00:00"><meta property="article:modified_time" content="2022-05-11T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Smart Contract Whitelist Mechanism"><meta name=twitter:description content="Common methods of Smart Contract Whitelist Mechanism"><meta itemprop=name content="Smart Contract Whitelist Mechanism"><meta itemprop=description content="Common methods of Smart Contract Whitelist Mechanism"><meta itemprop=datePublished content="2022-05-11T00:00:00+00:00"><meta itemprop=dateModified content="2022-05-11T00:00:00+00:00"><meta itemprop=wordCount content="949"><meta itemprop=keywords content="英文,Solidity,Blockchain,NFT,"></head><body class="dark:bg-gray-800 dark:text-white relative flex flex-col min-h-screen"><header class="container flex justify-between md:justify-between gap-4 flex-wrap p-6 mx-auto relative"><a href=https://albertlin0327.github.io/cn/ class="capitalize font-extrabold text-2xl"><img src=/logo.png alt="Albert Lin's Blog" class="h-8 max-w-full"></a>
<button class="mobile-menu-button md:hidden"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="8" x2="20" y2="8"/><line x1="4" y1="16" x2="20" y2="16"/></svg></button><ul class="mobile-menu absolute z-10 px-6 pb-6 md:p-0 top-full left-0 w-full md:w-auto md:relative hidden md:flex flex-col md:flex-row items-end md:items-center gap-4 lg:gap-6 bg-white dark:bg-gray-800"><li><a href=/cn/blog>文章</a></li><li><a href=/cn/tags>標籤</a></li><li><a href=/cn/about>關於我</a></li><li><a href=/cn/resume.pdf>履歷</a></li><li class="flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="mr-2" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><line x1="3.6" y1="9" x2="20.4" y2="9"/><line x1="3.6" y1="15" x2="20.4" y2="15"/><path d="M11.5 3a17 17 0 000 18"/><path d="M12.5 3a17 17 0 010 18"/></svg><a href=/en lang=en>English</a></li><li class="grid place-items-center"><span class="toggle-dark-mode inline-block cursor-pointer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="3"/><line x1="12" y1="5" x2="12" y2="5.01"/><line x1="17" y1="7" x2="17" y2="7.01"/><line x1="19" y1="12" x2="19" y2="12.01"/><line x1="17" y1="17" x2="17" y2="17.01"/><line x1="12" y1="19" x2="12" y2="19.01"/><line x1="7" y1="17" x2="7" y2="17.01"/><line x1="5" y1="12" x2="5" y2="12.01"/><line x1="7" y1="7" x2="7" y2="7.01"/></svg></span></li></ul></header><main class=flex-1><div class="relative max-w-5xl mx-auto px-4"><img src=/Start.png class="rounded-lg shadow-sm w-full object-contain"><div class="absolute top-4 right-8 rounded shadow bg-white text-gray-900 dark:bg-gray-900 dark:text-white px-2 py-0.5">May 11, 2022</div></div><article class="prose lg:prose-lg mx-auto my-8 dark:prose-dark px-4"><h1 class="text-2xl font-bold mb-2">Smart Contract Whitelist Mechanism</h1><h5 class="text-sm flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="mr-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="5" width="16" height="16" rx="2"/><line x1="16" y1="3" x2="16" y2="7"/><line x1="8" y1="3" x2="8" y2="7"/><line x1="4" y1="11" x2="20" y2="11"/><rect x="8" y="15" width="2" height="2"/></svg>Posted on
May 11, 2022
&nbsp;&bull;&nbsp;<svg xmlns="http://www.w3.org/2000/svg" class="mr-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
5&nbsp;minutes
&nbsp;&bull;<svg xmlns="http://www.w3.org/2000/svg" class="mx-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 19a9 9 0 019 0 9 9 0 019 0"/><path d="M3 6a9 9 0 019 0 9 9 0 019 0"/><line x1="3" y1="6" x2="3" y2="19"/><line x1="12" y1="6" x2="12" y2="19"/><line x1="21" y1="6" x2="21" y2="19"/></svg>
949&nbsp;words
&nbsp;&bull;&nbsp;&nbsp;<a href=https://albertlin0327.github.io/en/blog/220511-nft-minting/ lang=en>English</a></h5><p><em>Noted that this was previously published on medium and move to my blog.</em></p><h2 id=introduction>Introduction</h2><p>Whitelist is a great way to promote NFTs project and reward early entrance/ enthusiastic participants. There are a bunch of ways to implement the whitelist mechanism and each method comes with its own advantage and disadvantage. And now there are mainly 3 ways of implementing whitelist mechanism and now I am going to introduce them and talk about their pros and cons.</p><h2 id=most-primitive-way--store-it-in-storage>Most primitive way — Store it in storage</h2><p>For developers who are familiar with other language and modern computing system, storing data in heap or storage seems to be a quite reasonable and easy way to handle a series of data.</p><p>So to store whitelist in storage, you can simply declare a mapping to record all valid address that is eligible to whitelist mint. However, using this way will cause you A LOT OF GAS and is a really inefficient method. However, it will be easier for anyone to test whether he or she is on the whitelist through etherscan or a few lines of code.</p><script src=https://gist.github.com/AlbertLin0327/938e196c980c9717678aa61740f93e4f.js></script><p>Pros: Easy to Valid, Easy to Code, Easy to add an address or remove an address</p><p>Cons: Really inefficient, Really expensive for publisher</p><h2 id=the-smart-way-i--merkle-tree-airdrop>The smart way I — Merkle Tree Airdrop</h2><p>The other way to perform a whitelist will be availing merkle tree. Merkle tree is an important player in the blockchain. Merkle tree avails the property of hashing that a slight change in input will result in completely different outputs, and the fact that probability of two inputs resulting in the same output is nearly impossible.</p><p>The structure of merkle tree is shown below. The hash of the current node equals hashing of its left subnode, right subnode, and its data. Thus, from the property of hashing, any change will result in a completely different output; we can use this property to implement whitelist.</p><img src=/merkle-tree.png alt="Merkle Tree" width=600><p>So, let&rsquo;s imagine you want to know whether L1 equals an address, you can extract Hash 0–1, Hash 1, and the address that is willing to be tested. Then, you follow the hashing rule and compare the output of hashing with the Top Hash. It the result is the same, you can ensure that L1 equals the input address.</p><p>However, to do so, you will need to generate a merkle tree and take half of the minting process off-chain in order to save gas. We will use javascript to generate the merkle tree. If you are more familiar with ether.js, you can also use ethers.utils.solidityKeccak256 to hash the pair too. Also, remember to store the JSON file as below: <em>{"&lt;address>": &lt;amount>, &ldquo;&lt;address>&rdquo;: &lt;amount>}</em>. You can also change the pair to another type to adjust to your need.</p><script src=https://gist.github.com/AlbertLin0327/4b3a3265775e9d95c692faeb81fa9aac.js></script><p>You will need to store the root in the contract via solidity function. And then on-chain verification with the library MerkleProof. Thus, whenever someone wishes to mint, you have to generate the proof for the user whether in frontend or backend with tree.getHexProof function to generate the bytes32[] proof. You can see the comment in the checkTree function for more detailed implementation.</p><script src=https://gist.github.com/AlbertLin0327/dc608aff03cfb7abc3a3c47fb5fbf040.js></script><p>However, this means that you have to update the _freeClaimMerkleRoot whenever you wish to adjust the whitelist.</p><p>Pros: Economic efficient, easy to Valid</p><p>Cons: Slightly more gas for user to mint, Need to reset the root every time you wish to alter the whitelist</p><h2 id=the-smart-way-ii--backend-signature>The smart way II — Backend Signature</h2><p>The last way is also cheaper than the first way. However, the last way is a bit more centralized than the previous way. So, this method avails the mechanism of signing a message. You need to set up an address at the backend and keep it credentialed. And then, whenever a whitelisted user wishes to mint, you need to first verify it and the backend. After you verify it, you can sign the message and pass it back to the user. And then, the user can use the signed message and mint it.</p><p>But you may ask, how to make sure no one can forge the signing message? The reason is that if you sign a message with your private key, you will get a hashed message. And then, you can generate the public key with the hash message and the message before hashing. Thus, if you store the public key at the contract and sign the message with the private key at the backend, you can make sure no one can fake the message.</p><p>However, to prevent replay attacks, you can use a nonce to ensure that the signed message will not be used maliciously. Thus, the whole signing process will be as below:</p><script src=https://gist.github.com/AlbertLin0327/ddc47c25f047d3fd54fe41459bbbd654.js></script><p>Noted that one can even save some more gas by splitting the signature into (r, s, v) and pass it into the contract. Thus, the contract will not need to split the singature on chain.</p><pre tabindex=0><code class=language-{js} data-lang={js}>const signature = signner.signature;

const r = signature.slice(0, 66);

const s = &#34;0x&#34; + signature.slice(66, 130);

const v = parseInt(signature.slice(130, 132), 16);
</code></pre><p>Thus, after you generate the hashing message, namely hash and signature at the return data, you can pass it to the frontend for the user to mint NFT. Thus, you have to set up the verification on-chain.</p><script src=https://gist.github.com/AlbertLin0327/a43ecb2784fd50d2af0075053b86bf01.js></script><p>Pros: Cheaper for developers, easier to manage the whitelist at the backend</p><p>Cons: More gas require to mint, less decentralized</p><h2 id=conclusion>Conclusion</h2><p>There are a lot of ways to implement a whitelist mechanism. Each way is accompanied by its pros and cons. Thus, developers should carefully think about the needs and find a balance between each way. Also, I will continue to follow this article and write a depth inspection into the gas of the three methods. Keep an eye on my Twitter medium.</p></article><div class="bg-gray-300 dark:bg-gray-900"><div class="container px-6 py-12 mx-auto max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-8 items-center"><div><div class="text-2xl font-bold mb-2">Contact me ・ 聯絡我</div><p class=opacity-60>Let's build something great together</p></div><ul class="flex justify-center gap-4"><li><a href=https://twitter.com/Albert_Lin0 target=_blank rel=noopener aria-label=Twitter class="p-2 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li><li><a href=https://www.linkedin.com/in/albert-hk-lin/ target=_blank rel=noopener aria-label=LinkedIn class="p-2 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="4" width="16" height="16" rx="2"/><line x1="8" y1="11" x2="8" y2="16"/><line x1="8" y1="8" x2="8" y2="8.01"/><line x1="12" y1="16" x2="12" y2="11"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></a></li><li><a href=https://github.com/AlbertLin0327 target=_blank rel=noopener aria-label=GitHub class="p-2 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://medium.com/@linhsinkai target=_blank rel=noopener aria-label=Medium class="p-2 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="4" width="16" height="16" rx="2"/><path d="M8 9h1l3 3 3-3h1"/><line x1="8" y1="15" x2="10" y2="15"/><line x1="14" y1="15" x2="16" y2="15"/><line x1="9" y1="9" x2="9" y2="15"/><line x1="15" y1="9" x2="15" y2="15"/></svg></a></li></ul></div></div></main><footer class="container p-6 mx-auto flex justify-between items-center"><span class="text-sm font-light">Copyright © 2022 - Albert Lin | Powered by Hugo & blist</span>
<span onclick='window.scrollTo({top:0,behavior:"smooth"})' class="p-1 cursor-pointer"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 15l-6-6-6 6h12"/></svg></span></footer><script>const darkmode=document.querySelector(".toggle-dark-mode");function toggleDarkMode(){document.documentElement.classList.contains("dark")?(document.documentElement.classList.remove("dark"),localStorage.setItem("darkmode","light")):(document.documentElement.classList.add("dark"),localStorage.setItem("darkmode","dark"))}darkmode&&darkmode.addEventListener("click",toggleDarkMode);const darkStorage=localStorage.getItem("darkmode"),isBrowserDark=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;!darkStorage&&isBrowserDark&&document.documentElement.classList.add("dark"),darkStorage&&darkStorage==="dark"&&toggleDarkMode()</script><script>const mobileMenuButton=document.querySelector(".mobile-menu-button"),mobileMenu=document.querySelector(".mobile-menu");function toggleMenu(){mobileMenu.classList.toggle("hidden"),mobileMenu.classList.toggle("flex")}mobileMenu&&mobileMenuButton&&mobileMenuButton.addEventListener("click",toggleMenu)</script></body></html>